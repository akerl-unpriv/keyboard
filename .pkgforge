name 'model01-firmware'
org 'akerl'

source(
  type: 'git',
  path: '.'
)

build do
  run(
    "board/libraries/Kaleidoscope/bin/kaleidoscope-builder keyboard build",
    'LOCAL_CFLAGS' => '-DKALEIDOSCOPE_ENABLE_V1_PLUGIN_API=0',
    'ARDUINO_PATH' => '/usr/share/arduino',
    'ARDUINO_TOOLS_PATH' => '/usr/share/arduino/tools',
    'BOARD_HARDWARE_PATH' => 'hardware',
    'AVR_GCC_PREFIX' => '/usr',
    'AVR_SIZE' => '/usr/bin/avr-size'
  )
  cp 'output/keyboard/keyboard-latest.elf'
  cp 'output/keyboard/keyboard-latest.hex'
end

package(
  type: 'file',
  artifacts: [
    {
      source: 'output/keyboard/keyboard-latest.hex',
      name: 'keyboard.hex'
    },
    {
      source: 'output/keyboard/keyboard-latest.elf',
      name: 'keyboard.elf'
    }
  ]
)

test do
  # TODO: add tests
end
